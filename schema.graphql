enum PeriodicPrizePoolState {
  Opened
  Started
  Awarded
}

enum YieldServiceTokenType {
  cToken
}

type PrizePoolBuilder @entity {
  id: ID!
  trustedForwarder: Bytes!

  prizePoolModuleManagerFactory: Bytes!
  compoundYieldServiceFactory: Bytes!
  periodicPrizePoolFactory: Bytes!
  ticketFactory: Bytes!
  timelockFactory: Bytes!
  sponsorshipFactory: Bytes!

  interestTrackerFactory: Bytes!
  creditFactory: Bytes!

  governor: Bytes!
  rng: Bytes!
}

type SingleRandomWinnerPrizePoolBuilder @entity {
  id: ID!

  prizePoolBuilder: PrizePoolBuilder!
  prizeStrategyFactory: Bytes!
}

type PrizePoolModuleManager @entity {
  id: ID!
  block: BigInt!
  prizePoolBuilder: PrizePoolBuilder!

  creator: Bytes!
  prizeStrategy: Bytes!

  yieldService: Bytes!
  ticket: Bytes!
  credit: Bytes!
  sponsorship: Bytes!
  timelock: Bytes!
  prizePool: Bytes!
  interestTracker: Bytes!

  # draws: [Draw!]! @derivedFrom(field: "poolContract")
  # admins: [Admin!]! @derivedFrom(field: "poolContract")
  # players: [Player!]! @derivedFrom(field: "poolContract")
}

type PeriodicPrizePool @entity {
  id: ID!

  currentState: PeriodicPrizePoolState!
  currentPrizeId: BigInt!

  prizePoolModuleManager: PrizePoolModuleManager!

  prizeStrategy: Bytes!
  rng: Bytes!

  prizePeriodSeconds: BigInt!
  prizePeriodStartedAt: BigInt!

  previousPrize: BigInt
  previousPrizeAverageTickets: BigInt

  feeScaleMantissa: BigInt
  rngRequestId: BigInt

  prizes: [Prize!]! @derivedFrom(field: "prizePool")
}

type InterestTracker @entity {
  id: ID!

  prizePool: PeriodicPrizePool!
  prizePoolModuleManager: PrizePoolModuleManager!
}

type Ticket @entity {
  id: ID!
  
  prizePool: PeriodicPrizePool!
  prizePoolModuleManager: PrizePoolModuleManager!
  
  name: String!
  symbol: String!
  decimals: BigInt!
}

type Sponsorship @entity {
  id: ID!

  prizePool: PeriodicPrizePool!
  prizePoolModuleManager: PrizePoolModuleManager!

  name: String!
  symbol: String!
  decimals: BigInt!
}

type Timelock @entity {
  id: ID!

  prizePool: PeriodicPrizePool!
  prizePoolModuleManager: PrizePoolModuleManager!
}

type YieldService @entity {
  id: ID!

  token: Token!
  yieldServiceToken: YieldServiceToken!

  prizePool: PeriodicPrizePool!
  prizePoolModuleManager: PrizePoolModuleManager!

  accountedBalance: BigInt!
  balance: BigInt!
  unaccountedBalance: BigInt!

  supplyRatePerBlock: BigInt
}

type Token @entity {
  id: ID!

  name: String!
  symbol: String!

  decimals: BigInt!
}

type YieldServiceToken @entity {
  id: ID!

  token: Token!
  type: YieldServiceTokenType!

  prizePool: PeriodicPrizePool!
  prizePoolModuleManager: PrizePoolModuleManager!
}


# Ephemeral Types (not mapped to a specific contract)

# ID: `${prizePool.address}-${msg.sender.address}`
type Player @entity {
  id: ID!

  address: Bytes!
  prizePool: PeriodicPrizePool!
  
  balance: BigInt!

  timelockedBalance: BigInt!
  unlockTimestamp: BigInt!
}

# ID: `${prizePool.address}-${prizeId}`
type Prize @entity {
  id: ID!
  prizePool: PeriodicPrizePool!

  prize: BigInt
  reserveFee: BigInt
  rngRequestId: BigInt
  randomNumber: Bytes
  rewardStartedOperator: Bytes
  rewardCompletedOperator: Bytes

  winners: [Player!]
}

# type Sponsor @entity {
#   id: ID! 
#   address: Bytes!
#   poolContract: PoolContract!
#   sponsorshipAndFeeBalance: BigInt!
# }
